<!DOCTYPE HTML>
<html>
<head>
    <title>DEMO</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
    <style>
        #panorama {
            width: 900px;
            height: 450px;
        }
    </style>
</head>
<body>
    <!-- <iframe width="900" height="450" allowfullscreen style="border-style:none;" src="../../Pannellum/src/standalone/pannellum.htm?config=../../../Visit360/main/example_test.json"></iframe> -->
<!--     <div>Hello world!</div>-->    
    <div id="panorama"></div>
    <div id = "buttons">
        <h2>Add Hotspots</h2>
        <button id="addScene">Add Scene</button>
        <button id="information">Add Information</button>
        <button id="gateway">Add Gateway</button>
        <button id="deleteHotspot">Delete Hotspot</button>
    </div>

    <div id="gatewayInfo" style="display: none;">
        <label for="name">Next Scene ID :</label>
        <input type="text" id="endSceneId" name="endSceneId" required>

        <label for="name">Gateway Text :</label>
        <input type="text" id="gatewayText" name="gatewayText" required>

        <button id="submitButton">Submit</button>
    </div>
    <div id="hotspotInfoDesc" style="display: none;">

        <label for="name">Description :</label>
        <input type="text" id="infoText" name="infoText" required>

        <button id="submitButtonInfo">Submit</button>
    </div>

    <script>

    var initialConfig = 
        {
            "default": {
               "firstScene": "nature",
               "sceneFadeDuration": 2000,
               "hotSpotDebug" : true
            },

            "scenes": {
                "nature": {
                "title": "Nature",
                "panorama": "../content/panorama/examplepano.jpg",
                },
            }  
        }

    var hotspotInformation = {
        "pitch" : 0,
        "yaw" : 100,
        "type" : "info",
        "text" : "This is nature"
    }

/*     var hotspotGateway = {
        "pitch" : 0,
        "yaw" : -100,
        "type" : "scene",
        "text" : "Polytech",
        "sceneId" : "polytech"
    } */
    

        var scene_Polytech = {
            "title": "Polytech",
            "panorama": "../content/panorama/HALL.jpg",
            "hotSpots": [
                {
                    "pitch": -10,
                    "yaw": -50,
                    "type": "info",
                    "text": "Ceci est le Hall de Polytech"
                }, 
                {
                    "pitch": 0,
                    "yaw": -100,
                    "type": "scene",
                    "text": "Nature",
                    "sceneId": "nature",
                }
            ]
        }
    
    
        //loadScene(sceneId, targetPitch, targetYaw, targetHfov, fadeDone)
        var pan = pannellum.viewer('panorama', initialConfig);
        //pan.addHotSpot(hsi,'imag'); //ajouter un hotspot d'information
        //pan.removeScene('nature'); //supprimer une sc√®ne
        //console.log(pannellum.viewer('panorama', config2).getConfig())
        //pan.addHotSpot(hsp, 'nature');
/*         pan = pan.addScene("POLYTECH", scene_Polytech)
        console.log(pan.getConfig()) */

        const sceneButton = document.getElementById("addScene");
        const informationButton = document.getElementById("information");
        const gatewayButton = document.getElementById("gateway");
    
        

        sceneButton.addEventListener("click", function(){
            console.log("you added a scene")
            pan = pan.addScene("polytech", scene_Polytech);

        })

/*         informationButton.addEventListener("click", function(){

            console.log("you added an information")
            pan.addHotSpot(hotspotInformation, 'nature');

        }) */
/*         gatewayButton.addEventListener("click", function(){
            console.log("you added a gateway")
            pan.addHotSpot(hotspotGateway, 'nature');
        }) */

        var lastClickCoord = null

        //Get coordinates of the mouse in pitch and yaw
        const panoramaView = document.getElementById("panorama");
        
        panoramaView.addEventListener("click", function(event){
            lastClickCoord = null;
            console.log(pan.mouseEventToCoords(event));
            lastClickCoord = pan.mouseEventToCoords(event)
        })

        
        const gatewayAddDiv = document.getElementById("gatewayInfo");
        gatewayButton.addEventListener("click", function(){
                gatewayAddDiv.style.display = "block";
        })


        const informationAddDiv = document.getElementById("hotspotInfoDesc");
        informationButton.addEventListener("click", function(){
            informationAddDiv.style.display = "block";
        })
        
        const sceneIdField = document.getElementById("endSceneId");
        const gatewayText = document.getElementById("gatewayText");
        const submitButton = document.getElementById("submitButton");

        const infoText = document.getElementById("infoText");
        const submitButtonInfo = document.getElementById("submitButtonInfo");
        
        /*Note : hotspotID is common to both gateway hotpots and information hotspots in order to delete them easily
        by calling the function removeHotspot */
        var hotspotID = 0;
        submitButton.addEventListener("click", function(){
            var hotspotGateway = {}
            hotspotGateway["id"] = hotspotID+=1;
            hotspotGateway["pitch"] = lastClickCoord[0];
            hotspotGateway["yaw"] = lastClickCoord[1];
            hotspotGateway["type"] = "scene";
            hotspotGateway["sceneId"] = sceneIdField.value;
            hotspotGateway["text"] = gatewayText.value;
            hotspotGateway["clickHandlerFunc"] = myFunctionGateway;
            pan.addHotSpot(hotspotGateway, pan.getScene());
            console.log("you added a gateway");
            gatewayAddDiv.style.display = "none";
            sceneIdField.value = "";
            gatewayText.value = "";
            console.log(hotspotGateway)
            console.log(JSON.stringify(hotspotGateway));
            console.log(pan.getConfig());
        })


        submitButtonInfo.addEventListener("click", function(){
            var hotspotInformation={}
            hotspotInformation["id"] = hotspotID+=1;
            hotspotInformation["pitch"] = lastClickCoord[0];
            hotspotInformation["yaw"] = lastClickCoord[1];
            hotspotInformation["type"] = "info";
            hotspotInformation["text"] = infoText.value;
            hotspotInformation["clickHandlerFunc"] = myFunctionInformation;
            pan.addHotSpot(hotspotInformation, pan.getScene());
            console.log("you added an information")
            informationAddDiv.style.display = "none";
            infoText.value = "";
            console.log(hotspotInformation)
            console.log(JSON.stringify(hotspotInformation));
            console.log(pan.getConfig());
            console.log(pan.getScene());
        })
        
        var deletable = false;

        const deleteHotspotButton = document.getElementById("deleteHotspot");
        deleteHotspotButton.addEventListener("click", function(){
            if(deletable == false){
                deletable = true;
                deleteHotspotButton.style.backgroundColor='#ffcccb';
            }
            else{
                deletable = false;
                deleteHotspotButton.style.backgroundColor='';
            }
        })

        function myFunctionInformation(event, handlerArgs) {
            if(deletable == true){
                pan.removeHotSpot(this.id)
                console.log("Hotspot removed")
                deleteHotspotButton.style.backgroundColor = ""
                deletable = false;
            }
        }
        function myFunctionGateway(event, handlerArgs) {
            if(deletable){
                var currentScene = pan.getScene()
                console.log(currentScene)
                pan.removeHotSpot(this.id)
                pan.loadScene(currentScene)
                console.log("Hotspot removed")
                deleteHotspotButton.style.backgroundColor = ""
                deletable = false;
            }
        }


    </script>
            
</body>
</html>
